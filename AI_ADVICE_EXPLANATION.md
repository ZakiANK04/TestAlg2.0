# AI Advice System - What It's Based On

## Overview

The AI advice system analyzes multiple factors to provide actionable recommendations to farmers. The advice is generated by the `SmartProductionPlanningEngine` which evaluates each crop based on several key criteria.

## Data Sources

The AI advice is based on the following data inputs:

### 1. **Farm Information** (From Farmer Input)
- **Location/Region**: Selected region/wilaya
- **Farm Size**: Size in hectares
- **Soil Type**: Auto-detected from region or manually entered
  - Loam, Clay, Sand, or Silt
- **Soil pH**: Default 6.5 (neutral) or from soil tests

### 2. **Weather Data** (From OpenWeatherMap API)
- **Rainfall (mm)**: Current/forecasted rainfall
- **Temperature (Â°C)**: Average temperature
- **Humidity (%)**: Average humidity
- **Sunshine Hours**: Estimated based on cloud coverage

### 3. **Crop Data** (From Database)
- **Crop Name**: e.g., Potato, Tomato, Wheat
- **Ideal pH Range**: Minimum and maximum pH values
- **Water Requirements**: Required rainfall in mm per season
- **Growing Days**: Days to maturity
- **Base Yield**: Expected yield per hectare (tons/ha)

### 4. **Market Data** (From Database)
- **Price per kg**: Current market price in DA (Algerian Dinar)
- **Demand Index**: Market demand level (1.0 = normal, >1 = high)
- **Supply Volume**: Current supply in tons
- **Supply/Demand Ratio**: Calculated risk indicator

## Analysis Factors

The AI evaluates each crop using 4 main scoring factors:

### 1. **Soil Suitability Score** (30% weight)
**Based on:**
- **pH Compatibility**: 
  - Compares farm's soil pH with crop's ideal pH range
  - Penalty if pH difference > 1.0 (score -30)
  - Penalty if pH difference > 0.5 (score -10)
  
- **Soil Texture Compatibility**:
  - Checks if soil type matches crop needs
  - Sandy soil penalty for water-thirsty crops (>500mm requirement)
  - Score reduction: -20 for incompatible combinations

**Advice Generated:**
- âš ï¸ "Soil pH (X.X) is not ideal for [crop]. Consider soil amendment to adjust pH to Y.Y."
- âš ï¸ "Your [soil type] soil may not retain enough water for [crop]. Consider adding organic matter or irrigation."
- âœ… "Excellent soil conditions for [crop]! Your soil type and pH are well-suited."

### 2. **Yield Forecast Score** (20% weight)
**Based on:**
- **Rainfall Match**:
  - Compares expected rainfall with crop's water requirement
  - Excellent (95): Within 10% of requirement
  - Good (80): Within 30% of requirement
  - Poor (50): Within 50% of requirement
  - Failure Risk (20): >50% difference

**Advice Generated:**
- âš ï¸ "Low rainfall expected (X.Xmm). [Crop] needs YYmm. Plan for irrigation."
- âš ï¸ "High rainfall expected (X.Xmm). Ensure proper drainage to prevent waterlogging."
- âš ï¸ "Weather conditions may not be optimal for [crop]. Monitor closely."
- âœ… "Weather forecast is favorable for [crop]. Expected rainfall aligns well with crop requirements."

### 3. **Market Risk Score** (20% weight - subtracted from final score)
**Based on:**
- **Supply/Demand Ratio**:
  - Calculated as: `supply_volume_tons / (demand_index * 1000)`
  - High Risk (90): Ratio > 1.2 (oversupply)
  - Moderate Risk (60): Ratio > 1.0
  - Low Risk (20): Ratio < 1.0 (balanced)

**Advice Generated:**
- ğŸš¨ "HIGH RISK: Market oversupply detected for [crop]. Consider reducing planting area or delaying planting."
- âš ï¸ "Moderate oversupply risk for [crop]. Monitor market trends and consider diversifying crops."
- âœ… "Low market risk for [crop]. Current supply/demand balance looks favorable."

### 4. **Profitability Score** (30% weight)
**Based on:**
- **Expected Yield**: `base_yield_per_ha * (yield_score / 100)`
- **Revenue**: `expected_yield * price_per_kg * 1000` (tons to kg conversion)
- **Cost**: 50,000 DA per hectare (estimated)
- **Profit**: `revenue - cost`
- **Profit Score**: Normalized to 0-100 scale

**Advice Generated:**
- âš ï¸ "Low profitability expected for [crop]. Consider focusing on higher-scoring crops."
- ğŸ’° "High profit potential for [crop]! Current market prices (X.XX DA/kg) are favorable."

## Additional Advice Factors

### 5. **Planting Area Recommendations**
**Based on:**
- **Final Score**: Weighted combination of all factors
- **Recommended Area**: `farm_size * 0.7 * (final_score / 100)`
- **Percentage of Farm**: Calculated allocation percentage

**Advice Generated:**
- ğŸ’¡ "Consider planting [crop] on a smaller scale (X.XX ha) or focus on other crops."
- ğŸ’¡ "[Crop] is highly recommended. Consider allocating up to X.XX hectares (Y% of your farm)."

### 6. **Temperature Considerations**
**Based on:**
- **Average Temperature**: From weather API
- **Temperature Thresholds**:
  - Low: < 15Â°C
  - High: > 30Â°C

**Advice Generated:**
- ğŸŒ¡ï¸ "Low temperatures expected (X.XÂ°C). Some crops may need protection or delayed planting."
- ğŸŒ¡ï¸ "High temperatures expected (X.XÂ°C). Ensure adequate irrigation and consider heat-tolerant varieties."

## Final Score Calculation

The AI calculates a **Final Score** using weighted factors:

```
Final Score = (0.3 Ã— Soil Score) + (0.2 Ã— Yield Score) + (0.3 Ã— Profit Score) - (0.2 Ã— Risk Score)
```

**Weight Distribution:**
- **Soil Suitability**: 30% (most important)
- **Profitability**: 30% (most important)
- **Yield Forecast**: 20%
- **Market Risk**: 20% (subtracted, so high risk reduces score)

## Advice Generation Logic

The `generate_advice()` function creates advice by:

1. **Evaluating each factor** independently
2. **Checking thresholds** for each score
3. **Generating specific advice** based on:
   - Score ranges (low, moderate, high)
   - Specific values (pH, rainfall, temperature)
   - Calculated metrics (supply/demand ratio, profitability)
4. **Prioritizing critical issues** (high risk, low profitability)
5. **Providing actionable recommendations** (irrigation, soil amendment, planting area)

## Example Advice Flow

For a crop like "Potato":

1. **Soil Analysis**: 
   - pH = 6.5, Crop needs 5.5-7.0 â†’ âœ… Good match
   - Soil = Loam â†’ âœ… Compatible
   - **Result**: "Excellent soil conditions for Potato!"

2. **Weather Analysis**:
   - Rainfall = 25mm, Crop needs 600mm â†’ âš ï¸ Very low
   - **Result**: "Low rainfall expected. Plan for irrigation."

3. **Market Analysis**:
   - Supply/Demand = 0.8 â†’ âœ… Low risk
   - **Result**: "Low market risk for Potato."

4. **Profitability**:
   - Price = 16.72 DA/kg, Expected yield = 30 tons/ha
   - Revenue = 501,600 DA, Cost = 50,000 DA
   - Profit = 451,600 DA â†’ ğŸ’° High profit
   - **Result**: "High profit potential! Current prices are favorable."

5. **Final Recommendation**:
   - Final Score = 75.5
   - Recommended Area = 5.3 ha (70% of 10ha farm)
   - **Result**: "Potato is highly recommended. Consider allocating up to 5.3 hectares (53% of your farm)."

## Data Flow Summary

```
Farmer Input (Location, Size, Soil)
    â†“
Region Selection â†’ Auto Soil Type Detection
    â†“
Weather API â†’ Real-time Weather Data
    â†“
Database â†’ Crop Data + Market Data
    â†“
AI Engine â†’ Analysis & Scoring
    â†“
Advice Generation â†’ Actionable Recommendations
    â†“
Dashboard Display â†’ User sees advice
```

## Key Features

âœ… **Multi-factor Analysis**: Considers soil, weather, market, and profitability
âœ… **Real-time Data**: Uses live weather API data
âœ… **Risk Assessment**: Identifies market oversupply risks
âœ… **Actionable Advice**: Specific recommendations, not just scores
âœ… **Context-Aware**: Advice adapts to farm size, location, and conditions
âœ… **Prioritized Warnings**: Critical issues (ğŸš¨) highlighted first

This comprehensive analysis ensures farmers receive well-informed, actionable advice based on multiple data sources and agricultural best practices.

